var App={imagePathMens:null,imagePathWomens:null,videoPathMens:null,videoPathWomens:null,dataPath:null,Views:{},Routers:{},Collections:{},init:function(){_.extend(this,Backbone.Events),new App.Routers.Base,Backbone.history.start({root:"/fit-guide/"})}};Page=Backbone.Model.extend({defaults:{name:null,slug:null,title:null,nav_level:0,parent_id:null,childrenCount:0,isLoaded:!1,hasRendered:!1},initialize:function(){var a=this;if(a.id,void 0!=this.get("url")&&this.set({url:this.get("url")}),this.get("page")&&this.set({childrenCount:this.get("page").length}),"style"==this.get("type")){var c=this.get("slug").split("/"),d=this.get("views");this.set({compare_url:c[0]+"/"+"compare"+"/"+c[2]+"/-/",fit:this.get("parent_id")}),"mens"==this.get("root_section")?this.set({first_view:encodeURIComponent("http://"+location.host+App.imagePathMens+d[0].url)}):this.set({first_view:encodeURIComponent("http://"+location.host+App.imagePathWomens+d[0].url)})}"mens"==this.get("root_section")?this.set({image_path:App.imagePathMens,video_path:App.videoPathMens}):this.set({image_path:App.imagePathWomens,video_path:App.videoPathWomens}),this.set({htmlID:"el-"+this.cid,share_description:encodeURIComponent(this.get("short_description")),full_url:encodeURIComponent("http://"+location.host+"/fit-guide/#"+this.get("slug"))})},parse:function(a){this.get("url")?this.set({content:a.results}):this.set({page_header:a.content.page_header,page_copy:a.content.page_copy})},url:function(){return void 0!=this.get("url")?this.get("url"):this.collection.url+"index.php?page="+this.get("id")}}),ErrorPage=Backbone.Model.extend({defaults:{id:"error",name:"errorPage",slug:"",htmlID:"error",isLoaded:!0},initialize:function(){this.updateType()},updateType:function(){switch(this.get("type")){case"404":this.set({title:"Page Not Found",page_header:"The requested document couldn't be found.",page_copy:"<p>Please check the URL</p>"});break;case"data":this.set({title:"Page Could Not Load",page_header:"Page Could Not Load.",page_copy:"<p>The requested page could not load. Please check the URL and try refreshing.</p>"});break;default:this.set({title:"Page Not Found",page_header:"The requested document couldn't be found.",page_copy:"<p>Please check the URL</p>"})}}}),App.Views.Base=Backbone.View.extend({model:Page,comparePageModel:null,parentContainer:"#fitGuide",tagName:"div",className:"page-clip",events:{"mouseenter .silhouette-item":"silhouetteMouseEnter","mouseleave .silhouette-item":"silhouetteMouseLeave"},initialize:function(){var a=this;a.gaEventTracking("view","/fit-guide/"+location.hash)},render:function(){var a=this,b=this.model;this.pageHeader=$('<header id="section-header"/>').html("<h2>Select A Gender</h2>").css("opacity",0),this.pageCopy=$('<div class="page-copy"/>'),$.each(b.get("item"),function(b,c){c.image_path="mens"===c.name?App.imagePathMens:App.imagePathWomens;var d=$("#tpl-gender-item").html(),e=Mustache.render(d,c);$(a.pageCopy).append($(e).css("opacity",0))}),$(this.el).append(this.pageHeader,this.pageCopy),$(this.parentContainer).append(this.el),$("#silhouette-mens").css("left","-200px"),$("#silhouette-womens").css("left","900px"),this.transitionIn()},buildBackButton:function(a){if("home"!=a.get("page_id")){var b=a.get("parent_id");if(null!=this.options.comparePageModel){var c=$("<a/>").html("<span>X</span>").attr("id","btn-close").attr("href","#"+this.options.comparePageModel.get("slug"));if($("#section-header").append($(c)),"gender"!=this.model.get("type")){var d=this.options.comparePageModel.get("compare_url"),e=$("<a/>").html("BACK").attr("id","btn-back").attr("href","#"+d);$("#section-header").append($(e))}}else{if(""!=b){var f=a.collection.findWhere({page_id:b});if($("#section-header").length)var e=$("<a/>").html("BACK").attr("id","btn-back").attr("href","#"+f.get("slug"))}else var e=$("<a/>").html("BACK").attr("id","btn-back").attr("href","/fit-guide/#");$("#section-header").append($(e))}}},silhouetteMouseEnter:function(a){$(a.currentTarget).addClass("active"),TweenLite.to(".silhouette-item:not(.active) .list-view",.5,{opacity:"0"}),$(".silhouette-item > h3").length&&(TweenLite.to(".silhouette-item:not(.active) > h3",.5,{opacity:".5"}),TweenLite.to(".silhouette-item:not(.active) > p",.5,{opacity:".5"})),$(".silhouette-item .title-overlay").length&&TweenLite.to(".silhouette-item:not(.active) .title-overlay",.5,{opacity:"0"})},silhouetteMouseLeave:function(a){$(a.currentTarget).removeClass("active"),TweenLite.to(".silhouette-item .list-view",.5,{opacity:"1"}),$(".silhouette-item > h3").length&&(TweenLite.to(".silhouette-item:not(.active) > h3",.5,{opacity:"1"}),TweenLite.to(".silhouette-item:not(.active) > p",.5,{opacity:"1"})),$(".silhouette-item .title-overlay").length&&TweenLite.to(".silhouette-item:not(.active) .title-overlay",.5,{opacity:"1"})},touchOptimizing:function(a){a.preventDefault()},transitionIn:function(){var a=this,b=new TimelineLite({onComplete:a.transitionInComplete,onCompleteParams:[a]});b.to(a.pageHeader,.5,{opacity:"1"}).to($("#silhouette-mens"),.75,{left:"140px",ease:Power2.easeOut}).to($("#silhouette-womens"),.75,{left:"420px",ease:Power2.easeOut},"-=.75").to($("#silhouette-mens"),1,{opacity:"1"},"-=.5").to($("#silhouette-womens"),1,{opacity:"1"},"-=1").from(".silhouette-item h3",.5,{opacity:0},"-=.5")},transitionOut:function(){var a=this,b=new TimelineLite({onComplete:a.transitionOutComplete,onCompleteParams:[a]});b.to($("#silhouette-mens"),.5,{opacity:"1",left:"-200"}).to($("#silhouette-womens"),.5,{opacity:"1",left:"900px"},"-=.5").to(a.pageHeader,.25,{opacity:"0"})},transitionInComplete:function(){App.trigger("transitionInComplete")},transitionOutComplete:function(a){var a="undefined"!=typeof a?a:this;$(a.el).remove(),App.trigger("transitionOutComplete")},gaEventTracking:function(a,b){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","fit-guide",a,b])}}),App.Views.Gender=App.Views.Base.extend({model:Page,viewCount:3,currentItemPos:0,itemlength:null,touchStartPosX:null,touchEndPosX:null,events:{"mouseenter .silhouette-item:not(.being-compared)":"silhouetteMouseEnter","mouseleave .silhouette-item:not(.being-compared)":"silhouetteMouseLeave","click .being-compared":"diableSilhouette","click #btn-viewport-prev":"carouselSlide","click #btn-viewport-next":"carouselSlide","touchmove .page-copy":"touchOptimizing","swipe .page-copy":"carouselSwipe"},render:function(){var a=this,b=this.model,c=a.options.comparePageModel;if(this.$el.hammer(),this.pageHeader=$('<header id="section-header"/>'),null!=c){var d="<h2><span>Compare to "+c.get("name")+"</span> Select A Fit</h2>";$(this.pageHeader).addClass("compare-header")}else var d="<h2>Select A Fit</h2>";$(this.pageHeader).html(d).css("opacity",0),this.pageCopy=$('<div class="page-copy viewport"/>'),this.overview=$('<div class="overview"/>');var e=b.collection.where({parent_id:b.get("page_id")});$.each(e,function(b,d){var e=d.toJSON();null!=c&&(e.slug=a.buildCompareSlug(e));var f=$("#tpl-fit-item").html(),g=Mustache.render(f,e);$(a.overview).append($(g))}),$(this.pageCopy).append(this.overview),$(this.el).append(this.pageHeader,this.pageCopy),$(this.parentContainer).append(this.el),this.carouselSetup(this.overview),this.buildBackButton(b),this.transitionIn()},buildCompareSlug:function(a){var b=this.options.comparePageModel.get("page_id"),c=this.model.get("root_section")+"/compare/"+b+"/"+a.page_id+"/";return c},carouselSetup:function(a){this.itemlength=$(a).find("a").length,this.itemWidth=parseInt($(a).find("a").outerWidth(!0),10);var b=this.itemWidth*this.itemlength;$(a).css("width",b+"px"),this.itemlength>=this.viewCount?this.itemlength>this.viewCount&&(this.btnPrev=$('<div id="btn-viewport-prev" data-dir="prev"><span>prev</span></div>'),this.btnNext=$('<div id="btn-viewport-next" data-dir="next"><span>next</span></div>'),$(this.el).append(this.btnPrev,this.btnNext)):$(a).css("left",(645-b)/2)},carouselSlide:function(a){var b=$(a.currentTarget),c=this.carouselDirectionCheck(b.data("dir"));TweenLite.to(this.overview,.5,{left:c})},carouselSwipe:function(a){var b;this.itemlength>this.viewCount&&("left"==a.gesture.direction?b=this.carouselDirectionCheck("next"):"right"==a.gesture.direction&&(b=this.carouselDirectionCheck("prev")),TweenLite.to(this.overview,1,{left:b}))},carouselDirectionCheck:function(a){"next"==a?(this.currentItemPos++,this.currentItemPos>this.itemlength-this.viewCount&&(this.currentItemPos=0)):"prev"==a&&(this.currentItemPos--,this.currentItemPos<0&&(this.currentItemPos=this.itemlength-this.viewCount));var b=-(this.currentItemPos*this.itemWidth);return b},diableSilhouette:function(a){a.preventDefault()},transitionIn:function(){var a=this,b=new TimelineLite({onComplete:a.transitionInComplete,onCompleteParams:[a]});b.to(a.pageHeader,.5,{opacity:1}).from(a.overview,.75,{left:"900px"},"-=.25").staggerFrom(".silhouette-item",.75,{opacity:0,marginRight:"150px",ease:Power2.easeOut},0,"-=.25").from(a.overview,.5,{width:"5000px"}).from("#btn-viewport-prev",.5,{opacity:"0"},"-=.5").from("#btn-viewport-next",.5,{opacity:"0"},"-=1")},transitionOut:function(){var a=this,b=new TimelineLite({onComplete:a.transitionOutComplete,onCompleteParams:[a]});b.to(a.pageHeader,.2,{opacity:"0"}).to(a.pageCopy,.3,{opacity:"0"})}}),App.Views.Fit=App.Views.Gender.extend({model:Page,render:function(){var a=this,b=this.model,c=a.options.comparePageModel;if(this.$el.hammer(),this.pageHeader=$('<header id="section-header"/>'),null!=c){var d="<h2><span>Compare to "+c.get("name")+"</span> Select A Style</h2>";$(this.pageHeader).addClass("compare-header")}else var d="<h2><span>"+b.get("name")+"</span>Select A Style</h2>";$(this.pageHeader).html(d).css("opacity",0),this.pageCopy=$('<div class="page-copy viewport"/>'),this.overview=$('<div class="overview"/>');var e=b.collection.where({root_section:b.get("root_section"),parent_id:b.get("page_id")});$.each(e,function(b,d){var e=d.toJSON();null!=c&&(e.slug=a.buildCompareSlug(e),d.get("page_id")==c.get("page_id")&&(e.compared="being-compared"));var f=$("#tpl-style-item").html(),g=Mustache.render(f,e);$(a.overview).append($(g))}),$(this.pageCopy).append(this.overview),$(this.el).append(this.pageHeader,this.pageCopy),$(this.parentContainer).append(this.el),this.carouselSetup(this.overview),this.buildBackButton(b),this.transitionIn()},transitionIn:function(){var a=this,b=new TimelineLite({onComplete:a.transitionInComplete,onCompleteParams:[a]});b.to(a.pageHeader,.5,{opacity:1}).from(a.overview,.75,{left:"900px"},"-=.25").staggerFrom(".silhouette-item",.75,{opacity:0,marginRight:"150px",ease:Power2.easeOut},0,"-=.25").from(a.overview,.5,{width:"5000px"}).from("#btn-viewport-prev",.5,{opacity:"0"},"-=.5").from("#btn-viewport-next",.5,{opacity:"0"},"-=1")},transitionOut:function(){var a=this,b=new TimelineLite({onComplete:a.transitionOutComplete,onCompleteParams:[a]});b.to(a.pageCopy,.3,{opacity:"0"}).to(a.pageHeader,.2,{opacity:"0"})}}),App.Views.Style=App.Views.Base.extend({model:Page,currentItemPos:0,currentView:null,viewItem:".view-container .view-item",events:{"click .view-spot":"spotToggler","click #btn-view-prev":"slideshowSwitch","click #btn-view-next":"slideshowSwitch","click #style-nav .fit-nav-row":"navAccordion","click #size-chart":"sizeChartShow","swipe #style-view-column":"slideshowSwipe","touchmove .page-copy":"touchOptimizing"},render:function(){var a=this,b=this.model;this.$el.hammer(),this.pageCopy=$('<div class="page-copy"/>');var c=b.toJSON();c.sc_width="womens"==c.root_section?490:560;var d=$("#tpl-style-detail").html(),e=Mustache.render(d,c);$(a.pageCopy).append($(e)),$(this.el).append(this.pageCopy).addClass("style-clip"),$(this.parentContainer).append(this.el),$("#style-nav").append(this.navConstructor()),$("#facebook-image").attr("content",c.first_view);var f=$("#style-nav .fit-nav-row.active").find("ul").outerHeight()+15;$("#style-nav .fit-nav-row.active").css("height",f),this.slideshowlSetup(),this.videoSetup(),this.transitionIn()},navConstructor:function(){var a=this,b=$("<ul>"),c=1,d=a.model.collection.where({root_section:this.model.get("root_section")});return $.each(d,function(e,f){var g=f.get("nav_level"),h=f.get("childrenCount"),i=f.get("page_id");if(g==c){var j=$("#tpl-style-nav").html(),k=$('<li class="fit-nav-row">').append("<span>"+f.get("name")+"</span>");if(h>0){var l=$("<ul>");$.each(d,function(b,c){c.get("nav_level");var e=c.get("parent_id");if(e==i){var f=$("<li>").append(Mustache.render(j,c.toJSON()));a.model.get("slug")==c.get("slug")&&($(k).addClass("active"),$(f).addClass("active")),$(l).append($(f))}}),$(k).append($(l))}$(b).append($(k))}}),$(b)},videoSetup:function(){var a=this.model,b=this;if(!c)var c=_V_("fit-video");$("#btn-video").bind("click",function(){$("#fit-video-container").fadeIn(500),c.play(),b.gaEventTracking("video-play",a.get("name"))}),$("#fit-video-overlay").bind("click",function(){c.pause()}),$("#fit-video-pause-overlay").bind("click",function(){c.play()}),$("#fit-video-close-button").bind("click",function(){$("#fit-video-container").fadeOut(500,function(){$("#fit-video-pause-overlay").hide(),c.pause(),c.currentTime(0)})}),c.addEvent("pause",function(){$("#fit-video-overlay").hide(),$("#fit-video-pause-overlay").fadeIn(500),$("#fit-video-pause-overlay-play-btn").delay(500).fadeIn(500)}),c.addEvent("play",function(){$("#fit-video-overlay").show(),$("#fit-video-pause-overlay").fadeOut(500,function(){$(this).hide(),$("#fit-video-pause-overlay-play-btn").hide()})}),c.src([{type:"video/mp4",src:a.get("video_path")+a.get("video_url_mp4")},{type:"video/webm",src:a.get("video_path")+a.get("video_url_webm")},{type:"video/ogg",src:a.get("video_path")+a.get("video_url_ogv")}])},slideshowlSetup:function(){this.itemlength=$(this.viewItem).length,$(this.viewItem).css("opacity",0),this.currentView=$(this.viewItem).eq(this.currentItemPos),this.currentView.addClass("current-view"),this.currentView.css("opacity",1),this.btnPrev=$("#btn-view-prev"),this.btnNext=$("#btn-view-next")},slideshowSwitch:function(a){var b=$(a.currentTarget);this.slideshowDirectionCheck(b.data("dir")),this.currentView.removeClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:0}),this.currentView=$(this.viewItem).eq(this.currentItemPos),this.currentView.addClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:1})},slideshowSwipe:function(a){var b;a.preventDefault(),"left"==a.gesture.direction?b=this.slideshowDirectionCheck("next"):"right"==a.gesture.direction&&(b=this.slideshowDirectionCheck("prev")),this.currentView.removeClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:0}),this.currentView=$(this.viewItem).eq(this.currentItemPos),this.currentView.addClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:1})},slideshowDirectionCheck:function(a){"next"===a?(this.currentItemPos++,this.currentItemPos>this.itemlength-1&&(this.currentItemPos=0)):"prev"===a&&(this.currentItemPos--,this.currentItemPos<0&&(this.currentItemPos=this.itemlength-1))},spotToggler:function(a){$(a.currentTarget).toggleClass("active")},navAccordion:function(a){var b=$(a.currentTarget),c=b.siblings(),d=b.find("ul").outerHeight()+15;c.removeClass("active"),b.addClass("active"),TweenLite.to(c,.5,{height:15}),TweenLite.to(b,.5,{height:d})},sizeChartShow:function(a){a.preventDefault(),tb_show("",a.currentTarget.href)},transitionIn:function(){var a=this,b=new TimelineLite({onComplete:a.transitionInComplete,onCompleteParams:[a]});b.from(".view-item.current-view",.75,{opacity:0,left:"400px",ease:Power2.easeOut}).staggerFrom("#style-detail-column *",.75,{opacity:0},0,"-=.25").from("#view-nav",.5,{opacity:0},"-=.5").from("#style-controls",.25,{opacity:0},"-=.5").from("#style-measurements",.25,{opacity:0},"-=.5").from(".view-item .view-spot",.25,{opacity:0},"-=.5")},transitionOut:function(){var a=this,b=new TimelineLite({onComplete:a.transitionOutComplete,onCompleteParams:[a]});$("#fit-video-close-button").trigger("click"),b.to(a.pageCopy,.5,{opacity:"0"})}}),App.Views.Compare=App.Views.Style.extend({model:Page,model2:Page,currentView2:null,viewItem2:null,events:{"click .view-spot":"spotToggler","click #btn-view-prev":"slideshowSwitch","click #btn-view-next":"slideshowSwitch","click #style-nav > ul >li":"navAccordion","touchmove .page-copy":"touchOptimizing","swipe .page-copy":"slideshowSwipe"},render:function(){var b=this.model.toJSON(),c=this.options.model2.toJSON();this.$el.hammer(),b.new_compare=c.compare_url,c.new_compare=b.compare_url,this.pageCopy=$('<div class="page-copy"/>');var d=$("#tpl-compare-item").html();$(this.pageCopy).append(Mustache.render(d,b)),$(this.pageCopy).append(Mustache.render(d,c)),$(this.pageCopy).append($("#tpl-compare-view-nav").html()),$(this.el).append(this.pageCopy),$(this.parentContainer).append(this.el),this.slideshowlSetup(),this.transitionIn()},slideshowlSetup:function(){this.viewItem=$("#compare-"+this.model.get("htmlID")+" .view-container .view-item"),this.viewItem2=$("#compare-"+this.options.model2.get("htmlID")+" .view-container .view-item"),this.itemlength=$(this.viewItem).length,$(this.viewItem).css("opacity",0),$(this.viewItem2).css("opacity",0),this.currentView=$(this.viewItem).eq(this.currentItemPos),this.currentView2=$(this.viewItem2).eq(this.currentItemPos),this.currentView.addClass("current-view"),this.currentView2.addClass("current-view"),this.currentView.css("opacity",1),this.currentView2.css("opacity",1),this.btnPrev=$("#btn-view-prev"),this.btnNext=$("#btn-view-next")},slideshowSwitch:function(a){var b=$(a.currentTarget);this.slideshowDirectionCheck(b.data("dir")),this.currentView.removeClass("current-view"),this.currentView2.removeClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:0}),TweenLite.to(this.currentView2,.5,{opacity:0}),this.currentView=$(this.viewItem).eq(this.currentItemPos),this.currentView2=$(this.viewItem2).eq(this.currentItemPos),this.currentView.addClass("current-view"),this.currentView2.addClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:1}),TweenLite.to(this.currentView2,.5,{opacity:1})},slideshowSwipe:function(a){var b;"left"==a.gesture.direction?b=this.slideshowDirectionCheck("next"):"right"==a.gesture.direction&&(b=this.slideshowDirectionCheck("prev")),this.currentView.removeClass("current-view"),this.currentView2.removeClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:0}),TweenLite.to(this.currentView2,.5,{opacity:0}),this.currentView=$(this.viewItem).eq(this.currentItemPos),this.currentView2=$(this.viewItem2).eq(this.currentItemPos),this.currentView.addClass("current-view"),this.currentView2.addClass("current-view"),TweenLite.to(this.currentView,.5,{opacity:1}),TweenLite.to(this.currentView2,.5,{opacity:1})},transitionIn:function(){var a=this,b=new TimelineLite({onComplete:a.transitionInComplete,onCompleteParams:[a]});b.from(".view-container",1.5,{opacity:0,ease:Power2.easeOut}).from(".compare-detail-column",1,{opacity:0},"-=.5").from(".view-item .view-spot",.5,{opacity:0},"-=.5")},transitionOut:function(){var a=this,b=new TimelineLite({onComplete:a.transitionOutComplete,onCompleteParams:[a]});b.to(a.pageCopy,.7,{opacity:"0"})}}),App.Views.Navigation=Backbone.View.extend({initialize:function(){this.render()},render:function(){},navConstructor:function(a,b){var c=$("<ul>");return a.each(function(d){var e=d.get("nav_level"),f=d.get("childrenCount"),g=d.get("page_id");if(e==b){var h=$("#tpl-primary-nav").html(),i=Mustache.render(h,d.toJSON());if(f>0){var j=$("<ul>");a.each(function(a){a.get("nav_level");var c=a.get("parent_id");if(c==g){var d=Mustache.render(h,a.toJSON());$(j).append($(d))}}),$(i).append($(j))}$(c).append($(i))}}),$(c)},breadcrumbConstructor:function(a,b){var c=this,d=$("<ul>"),e=[],f=new Backbone.Collection([]);"home"!=a.get("id")&&(a.get("parent_id")&&(f=c.locateParent(a,f)),f.add([{name:a.get("name"),slug:a.get("slug")}]),e.crumbs=f.toJSON());var g=$("#tpl-primary-nav").html(),h=Mustache.render(g,e);$(d).append($(h)),b&&($(d).append("<li>&gt;</li>"),$(d).append(this.buildCompareCrumb(a))),$("#fg-primary-nav").html(d)},locateParent:function(a,b){var c=this,d=this.collection.findWhere({root_section:a.get("root_section"),page_id:a.get("parent_id")});return d.get("parent_id")&&(b=c.locateParent(d,b)),b.add([{name:d.get("name"),slug:d.get("slug")}]),b},buildCompareCrumb:function(a){return $("<li/>").html('<a href="#'+a.get("compare_url")+'">Compare</a>')},buildBackButton:function(a){if("home"!=a.get("id")){var b=a.get("parent_id");if(""!=b){var c=this.collection.findWhere({id:b});if($("#section-header").length)var d=$("<a/>").html("BACK").attr("id","btn-back").attr("href",c.get("slug"))}else var d=$("<a/>").html("BACK").attr("id","btn-back").attr("href","/fit-guide/#");$("#section-header").append($(d))}},updateNavigation:function(a){if("error"!=a){var b=this;$(this.el).find("a").removeClass("current-page"),$("#"+a).addClass("current-page"),this.pageModel=this.collection.find(function(b){return b.get("htmlID")===a}),""!=this.pageModel.get("parent_id")&&(this.parrentPageModel=this.collection.find(function(a){return a.get("id")===b.pageModel.get("parent_id")}),$("#"+this.parrentPageModel.get("htmlID")).addClass("current-page"))}}}),App.Views.Loader=Backbone.View.extend({parentContainer:"#fitGuide",className:"loaderView",tagName:"div",imagesArray:[],initialize:function(){var a=this;if(this.render(),a.imagesArray=[],"style"===a.model.get("type"))$.each(a.model.get("views"),function(b,c){a.imagesArray.push(a.model.get("image_path")+c.url)});else if("default"===a.model.get("type"))a.annouceLoadStatus();else{var b=a.model.collection.where({parent_id:a.model.get("page_id"),root_section:a.model.get("root_section")});$.each(b,function(b,c){$.each(c.get("images"),function(b,c){a.imagesArray.push(a.model.get("image_path")+c.url)})})}a.preloadImages(a.imagesArray).done(function(){a.annouceLoadStatus()})},render:function(){$(this.parentContainer).append(this.el)},preloadImages:function(a){function f(){d++,d==a.length&&e(c)}for(var c=[],d=0,e=function(){},a="object"!=typeof a?[a]:a,g=0;g<a.length;g++)c[g]=new Image,c[g].src=a[g],c[g].onload=function(){f()},c[g].onerror=function(){f()};return{done:function(a){e=a||e}}},annouceLoadStatus:function(){App.trigger("imagePreloadingComplete"),this.clearLoader()},clearLoader:function(){$(this.el).remove(),this.remove()}}),App.Routers.Base=Backbone.Router.extend({pages:null,navigationVeiw:null,currentPageView:null,lastPageView:null,loaderView:null,currentPageModel:null,comparePageModel1:null,comparePageModel2:null,inCompareMode:!1,isPagesLoaded:!1,isFirstRun:!0,nextPage:"",defualtTitle:"",routes:{":gender/compare/:style1/:style2/":"compareHandeler","*actions":"defaultHandeler"},initialize:function(){var a=this;a.pages=new App.Collections.Pages,App.bind("transitionOutComplete",function(){a.currentPageView.render()}),App.bind("transitionInComplete",function(){}),App.bind("imagePreloadingComplete",function(){a.pageTransition()}),$.getJSON(App.dataPath,function(b){if(b)if(a.pages.defualtTitle=b.site.title,a.pages.collectPages(b.site.page),a.isPagesLoaded=!0,a.navigationVeiw=new App.Views.Navigation({collection:a.pages}),a.inCompareMode){var c=a.nextPage.split("/");a.compareHandeler(c[0],c[2],c[3])}else a.pageHandeler(a.nextPage);else a.displayErrorPage("data",!0)})},compareHandeler:function(a,b,c){var d;this.inCompareMode=!0,this.isPagesLoaded?(this.comparePageModel1=this.pages.findWhere({root_section:a,page_id:b}),"-"===c?(d=a+"/",this.pageHandeler(d)):void 0!==this.pages.findWhere({page_id:c,type:"fit"})?(d=a+"/"+c+"/",this.pageHandeler(d)):(this.comparePageModel2=this.pages.findWhere({root_section:a,page_id:c}),this.currentPageModel=this.comparePageModel1,this.isFirstRun||(this.lastPageView=this.currentPageView),this.currentPageView=new App.Views.Compare({model:this.comparePageModel1,model2:this.comparePageModel2,id:"compare-content"}),this.getLoader())):(d=a+"/"+"compare/"+b+"/"+c+"/",this.nextPage=d)},defaultHandeler:function(a){this.inCompareMode=!1,this.comparePageModel1=null,this.comparePageModel2=null,this.pageHandeler(a)},pageHandeler:function(a){var b=this.uriCheck(a);this.isPagesLoaded&&b?(a?(this.currentPageModel=this.pages.find(function(b){return b.get("slug")===a}),void 0===this.currentPageModel&&(location.hash="#")):this.currentPageModel=this.pages.first(),this.isFirstRun||(this.lastPageView=this.currentPageView),this.currentPageView=this.pageViewSelector(),this.getLoader()):this.nextPage=a},uriCheck:function(a){var a="undefined"!=typeof a?a:"";if(null===a)return"home/";if(a.length){var b=a.length,c=a.charAt(b-1);return"/"!==c&&""!==a?(location.hash="#/"+a+"/",!1):!0}},pageViewSelector:function(){var b,a=this.currentPageModel.get("page_id")+"-content";switch(this.currentPageModel.get("type")){case"gender":b=new App.Views.Gender({model:this.currentPageModel,id:a,comparePageModel:this.comparePageModel1});break;case"fit":b=new App.Views.Fit({model:this.currentPageModel,id:a,comparePageModel:this.comparePageModel1});break;case"style":b=new App.Views.Style({model:this.currentPageModel,id:a});break;default:b=new App.Views.Base({model:this.currentPageModel,id:a})}return b},pageTransition:function(){this.isFirstRun?(this.isFirstRun=!1,this.currentPageView.render()):null!==this.lastPageView&&this.lastPageView.transitionOut(),this.inCompareMode?this.navigationVeiw.breadcrumbConstructor(this.comparePageModel1,!0):this.navigationVeiw.breadcrumbConstructor(this.currentPageModel,!1)},fetchModelData:function(){var a=this;a.getLoader(),this.currentPageModel.fetch({success:function(){a.currentPageModel.set({isLoaded:!0}),a.loaderView.clearLoader(),a.currentPageView.render()},error:function(){a.displayErrorPage("data",!0)}})},getLoader:function(){-1===navigator.appVersion.indexOf("MSIE 8.0;")?this.loaderView=new App.Views.Loader({model:this.currentPageModel}):this.pageTransition()},displayErrorPage:function(a,b){this.currentPageModel=this.pages.find(function(a){return"error"===a.get("id")}),void 0===this.currentPageModel?(this.currentPageModel=new ErrorPage({type:a}),this.pages.add(this.currentPageModel)):(this.currentPageModel.set({type:a}),this.currentPageModel.updateType()),b&&(this.currentPageView=this.pageViewSelector(a),this.pageTransition())}}),App.Collections.Pages=Backbone.Collection.extend({model:Page,rootSection:null,initialize:function(){},collectPages:function(a,b,c,d){var b="undefined"!=typeof b?b:"",c="undefined"!=typeof c?c:"",d="undefined"!=typeof d?d:0,f=this;_(a).map(function(a){a.title=encodeURIComponent(Mustache.render(f.defualtTitle,a)),a.parent_id=b,a.nav_level=d,a.page_id=a.name.replace(" / ","-").toLowerCase(),a.page_id=a.page_id.replace(" ","-").toLowerCase(),d>0?(a.slug=c+a.page_id+"/",a.root_section=this.rootSection):(a.slug=a.page_id+"/",this.rootSection=a.page_id,a.root_section=a.page_id);var e=new Page(a);f.add(e),a.page&&f.collectPages(a.page,a.page_id,a.slug,d+1)})}});